\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{vmlmacros}[2011/02/23 v1.0 Custom VML macros.]
% Thank you Norman Ramsey and Cheng Shao for the foundation needed for these!
\RequirePackage{amsmath}
\RequirePackage{geometry}
\RequirePackage{amsthm}
\RequirePackage{amssymb}
\RequirePackage{tikz}
\RequirePackage{graphicx}
\RequirePackage{ebproof}
\RequirePackage{alltt}
\RequirePackage{verbatim}
\RequirePackage{hyperref}
\RequirePackage{amsmath}
\RequirePackage{qtree}
\RequirePackage{semantic}
\RequirePackage{mathpartir}
\RequirePackage[anticlockwise]{rotating}
\RequirePackage{upgreek}
\RequirePackage{listings}
\RequirePackage{color}


%%%%%%%%%% LANGUAGES %%%%%%%%%%
\newcommand\Vminus{\ensuremath{V^{-}}}
\newcommand\Pplus{\ensuremath{P^{+}}}
\newcommand\D{\ensuremath{D}}

%%%%%%%%%% GENERAL MATH %%%%%%%%%%
\newcommand\gt{\mathrel{>}}
\newcommand\lt{\mathrel{<}}

\newcommand{\bracketed}[1]{\{#1\}}
\newcommand{\ttbraced}[1]{\tt{(}#1\tt{)}}

%%%%%%%%%% FORMATTING %%%%%%%%%%
\newcommand\vfilbreak[1][1in]{\vskip 0pt plus #1\penalty-200 \vskip 0pt plus -#1}

%%%%%%%%%% VERSE ABSTRACT SYNTAX %%%%%%%%%%

% Symbols 
\newcommand{\choice}{\vrule width 2pt height 7pt}
\newcommand{\vlambda}[2]{\lambda \langle #1 \rangle. \; #2}

%%%%%%%%%% VERSE CONCRETE SYNTAX %%%%%%%%%%

%%%%%%%%%% VERSE JUDGEMENT RULES %%%%%%%%%%

%%% Symbols 

% Context 
\newcommand\rhohat{\hat{\rho}}
\newcommand\tempstuck[1][\bracketed{eq}]{\tt{?t.}\it{#1}}
\newcommand\context{\ensuremath{\mathcal{T}}}


% Singletons 
\newcommand\fail{\bf{fail}}
\newcommand\reject{\bf{reject}}
\newcommand\valbar{\ensuremath{v^{\alpha}}}
\newcommand\result{\it{r}}
\newcommand\arrowe{\rightarrow e}

\newcommand\galpha{\ensuremath{g_{\alpha}}}
\newcommand\ealpha[1][]{\ensuremath{e_{\alpha_{#1}}}}
\newcommand\ealphaone{\ensuremath{e_{\alpha_{1}}}}
\newcommand\ealphatwo{\ensuremath{e_{\alpha_{2}}}}
\newcommand\ealphan{\ensuremath{e_{\alpha_{n}}}}
\newcommand\ealphai{\ensuremath{e_{\alpha_{i}}}}
\newcommand\Dalpha{\ensuremath{\mathcal{D}_\alpha}}
\newcommand\valpha{\ensuremath{\vartheta}}
\newcommand\Rho{\ensuremath{\rho}}
\newcommand\Rhoprime{\ensuremath{\rho'}}

\newcommand\uppsidown{
    \raisebox{1.25ex}{
      \hspace{-0.75em}
      \begin{sideways}
        \ensuremath{\uppsi}
      \end{sideways}}
      }

% Wrapping forms 
\newcommand\iffi[1]{\textsc{if} \; [\; #1 \; ] \; \textsc{fi}}
\newcommand\TeqT[1]{\context \cdot #1 \cdot \context'}
\newcommand\eqTT[1]{#1 \cdot \context \cdot \context'}
\newcommand\TT{\context \cdot \context'}

% Shortcuts 



% Latex abbreviations 


%  Judgements 
\newcommand{\vtuple}[1]{%
  \let\c=\component%
  \ensuremath{\langle #1 \rangle}%
  }
  

% \newcommand\veval[3]
\newcommand{\vjudgement}[2]{#1 \rightarrowtail{} #2}
  
\newcommand{\veval}[2]{\langle \rho,  #1 \rangle \Downarrow #2}
\newcommand{\vevalext}[3]{\langle \rho#1,  #2 \rangle \Downarrow #3}
% \newcommand{\veval}[2]{\rho; \; \context \vdash #1 \Downarrow #2}

\newcommand{\showvjudgement}[3][Right]{%
  \[\inferrule*[#1=\textsc{ (#2) }]%
  {}      
  {#3}\]%
}
      
\newcommand{\mkjudgementcmd}[3]{%
  \expandafter\newcommand\csname #1\endcsname{\vjudgement{#2}{#3}}%
  }

\newcommand{\mkevaljudgementcmd}[3]{%
  \expandafter\newcommand\csname #1\endcsname{\veval{#2}{#3}}%
  }
%%%%%%%%%% TRANSLATION %%%%%%%%%%
      
      % Translation rules with oxford brackets
\newcommand{\oxs}[1]{[\![#1]\!]}
\newcommand{\translate}[1]{ \mathcal{T} \oxs{#1}}
\newcommand{\desugar}[1]{ \mathcal{D} \oxs{#1}}

%%%%%%%%%% VANITY %%%%%%%%%%
\newcommand\nr[1]{\leavevmode\emph{NR: #1}}
\newcommand\rab[1]{\leavevmode\emph{rab: #1}}

%%%%%%%%%% OTHER %%%%%%%%%%

% Abbreviations 
\renewcommand{\tt}[1]{\texttt{#1}}
\renewcommand{\it}[1]{\textit{#1}}
\renewcommand{\bf}[1]{\textbf{#1}}
\renewcommand{\rm}[1]{\textrm{#1}}

% Fonts
\newcommand{\ppl}[1]{{\fontfamily{ppl}\selectfont #1}}

% Lists 
\newcommand\eq{\ensuremath{\mathit{eq}}}  % equation
\newcommand\xs{\ensuremath{\mathit{xs}}}
\newcommand\ys{\ensuremath{\mathit{ys}}}
\newcommand\zs{\ensuremath{\mathit{zs}}}
\newcommand\emptyseq{\ensuremath{\varepsilon}}



% Nice judgement and rule forms
\newcommand{\mono}[1]{%  Thanks Paul A. (Windfall Software)
\makeatletter
  {\@tempdima = \fontdimen2\font
   \frenchspacing
   \texttt{\spaceskip = 1.1\@tempdima{}#1}}}
\newcommand\xmono[2][1.1]
  {\@tempdima = \fontdimen2\font
   \frenchspacing
   \texttt{\spaceskip = #1\@tempdima{}#2}}
\makeatother
\newcommand*\monobox[2][1.1]{\mbox{\upshape\xmono[#1]{#2}}}

\newcommand\emptylist{\ensuremath{[\,]}}
\usepackage{keyval}


\makeatletter
\newcommand\defcomponent[2]{%
  \define@key{state}{#1}{\@nameuse{setmyval@#1}{##1}}%
  \@namedef{setmyval@#1}##1{\@namedef{myval@#1}{##1}}%
  \@nameuse{setmyval@#1}{\ensuremath{#2}}%
}

\newcommand\component[1]{\@nameuse{myval@#1}}

\makeatother

\defcomponent{env}{\rho}
\defcomponent{context}{\context}
\defcomponent{term}{\galpha}
\defcomponent{guard}{g}
\defcomponent{result}{\result}
\defcomponent{envext}{}
\defcomponent{newenv}{\rho'}
\defcomponent{eq}{\eq}


\newcommand\emptycontext{\varepsilon}
\newcommand\emptyenv{\mathord{\{\,\}}}

\newcommand\vmrun[1][]{%  run V-minus code
  {\setkeys{state}{#1}%
   \let\c=\component
   \ensuremath{\c{env}\c{envext}; \c{context} \vdash \c{term} \Downarrow \c{result}}}}
   
\newcommand\vmrung[1][]{%  run V-minus code with normal g
   {\setkeys{state}{#1}%
   \let\c=\component
   \ensuremath{\c{env}\c{envext}; \c{context} \vdash \c{guard} \Downarrow \c{result}}}}
   
\newcommand\prun[1][]{%  run P-plus code
  {\setkeys{state}{#1}%
    \let\c=\component
    \ensuremath{\c{env}\c{envext}; \c{context} \vdash \c{term} \Downarrow \c{result}}}}

\newcommand\eqrefine[1][]{%  equation refines environment
  {\setkeys{state}{#1}%
  \let\c=\component
  \ensuremath{\langle \c{env}\c{envext}, \c{eq} \rangle \rightarrowtail \c{newenv}}}}

\newcommand\eqfail{\eqrefine[newenv=\dagger]}

\defcomponent{vterm}{e}
\defcomponent{vresult}{e'}

\newcommand\vrun[1][]{% run Verse code
  {\setkeys{state}{#1}%
   \let\c=\component
   \ensuremath{\c{vterm} \mathrel{\rightarrow^{*}} \c{vresult}}}}
\newcommand\translation[2][]{\ensuremath{#1[\![#2]\!]}}


\newcommand{\goesto}[1]{\xrightarrow{#1}} % {\stackrel{#1}{\longrightarrow}}

    % rough opsem-based stuff: to change
\newcommand{\br}[1]{\langle #1 \rangle}

% Listings color 
\definecolor{eclipseBlue}{RGB}{42,0.0,255}
\definecolor{eclipseGreen}{RGB}{63,127,95}

\newcommand\smllst
{\lstset {
  basicstyle=\small\ttfamily,
  captionpos=b,
  tabsize=2,
  columns=fixed,
  breaklines=true,
  frame=l,
  numbers=left,
  numberstyle=\small\ttfamily,
  morekeywords= {
    EQUAL, GREATER, LESS, NONE, SOME, abstraction, abstype, and, andalso, array, as, before, bool, case, char, datatype, do, else, end, eqtype, exception, exn, false, fn, fun, functor, handle, if, in, include, infix, infixr, int, let, list, local, nil, nonfix, not, o, of, op, open, option, orelse, overload, print, raise, real, rec, ref, sharing, sig, signature, string, struct, structure, substring, then, true, type, unit, val, vector, where, while, with, withtype, word
  },
  morestring=[b]",
  morecomment=[s]{(*}{*)},
  stringstyle=\color{black},
  identifierstyle=\color{teal},
  keywordstyle=\color{orange},
  commentstyle=\color{eclipseGreen}
}}

\newcommand\verselst
{\lstset {
  basicstyle=\small\ttfamily,
  captionpos=b,
  tabsize=2,
  columns=fixed,
  breaklines=true,
  frame=l,
  numbers=left,
  numberstyle=\small\ttfamily,
  morekeywords= {
    EQUAL, GREATER, LESS, NONE, SOME, raise, $\exists$, if, then, else, =
  },
  morestring=[b]",
  morecomment=[s]{(*}{*)},
  stringstyle=\color{black},
  identifierstyle=\color{teal},
  keywordstyle=\color{orange},
  commentstyle=\color{eclipseGreen},
  mathescape
}}

%  Bulk command definition
% \def\do#1{\expandafter\newcommand\csname#1\endcsname{\elem{#1}}}
% \docsvlist {fire,earth,air,ice,dark,light,wild}
% \let\frost\ice

% \newcommand\bulkdef[2]{% command arglist
%   \def\do##1{\expandafter\newcommand\csname##1\endcsname{#1{##1}}}%
%   \docsvlist{#2}}

% \bulkdef\gen{attack,jump,range,move,shield,loot,retaliate,teleport,xp,heal,target,damage}  
% \bulkdef\cond{push,pull,muddle,bane,poison,wound,invisible,immobilize,disarm,curse,stun,strengthen,pierce,brittle,bless,impair}
% \newcommand\eat{\consume}

% \bulkdef\icon{shuffle}

% \let\shuffleicon=\shuffle
% \def\shuffle{\hfill\shuffleicon\mbox{\hskip 0.5em}\parfillskip=0pt}




% \newcommand\cons[2]{\ensuremath{#1\mathbin::#2}}
\newcommand\cons{\tt{::}}
\newcommand\parthreads[2]{\ensuremath{#1\mathbin\mid#2}}
